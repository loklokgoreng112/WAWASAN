import React, { useState } from 'react';
import { Sparkles, Gift, RefreshCw, Star, Moon, Zap } from 'lucide-react';

const MysteryBox = () => {
  const [selectedBox, setSelectedBox] = useState(null);
  const [revealedPrize, setRevealedPrize] = useState(null);
  const [isAnimating, setIsAnimating] = useState(false);
  const [openedBoxes, setOpenedBoxes] = useState([]);
  const [userId, setUserId] = useState('');
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [shuffledPrizes, setShuffledPrizes] = useState([]);
  const [showAllPrizes, setShowAllPrizes] = useState(false);

  const prizes = [
    { id: 1, title: "Rp 350.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Uang Tunai", icon: "ğŸ’µ", color: "from-green-400 to-emerald-500" },
    { id: 2, title: "Rp 500.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Uang Tunai", icon: "ğŸ’µ", color: "from-green-500 to-emerald-600" },
    { id: 3, title: "Rp 75.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Uang Tunai", icon: "ğŸ’µ", color: "from-green-600 to-teal-600" },
    { id: 4, title: "Rp 100.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Uang Tunai", icon: "ğŸ’¸", color: "from-blue-500 to-cyan-500" },
    { id: 5, title: "Rp 150.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Uang Tunai", icon: "ğŸ’¸", color: "from-blue-600 to-cyan-600" },
    { id: 6, title: "Rp 200.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Uang Tunai", icon: "ğŸ’°", color: "from-purple-500 to-pink-500" },
    { id: 7, title: "Rp 300.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Hadiah Spesial", icon: "ğŸ’°", color: "from-yellow-400 to-amber-500" },
    { id: 8, title: "Rp 250.000", content: "SCREENSHOT & KIRIM BUKTI KE LIVECHAT", category: "Grand Prize", icon: "ğŸ’°", color: "from-indigo-600 to-purple-700" }
  ];

  const shuffleArray = (array) => {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
  };

  const handleLogin = () => {
    const trimmedId = userId.trim();
    if (!trimmedId) {
      alert('Silakan masukkan User ID Anda!');
      return;
    }

    const usedIds = JSON.parse(localStorage.getItem('usedUserIds') || '[]');
    if (usedIds.includes(trimmedId)) {
      alert(`User ID "${trimmedId}" sudah pernah digunakan! Silakan gunakan User ID yang berbeda.`);
      setUserId('');
      return;
    }

    usedIds.push(trimmedId);
    localStorage.setItem('usedUserIds', JSON.stringify(usedIds));
    
    setShuffledPrizes(shuffleArray(prizes));
    setIsLoggedIn(true);
  };

  const handleBoxClick = (prize) => {
    if (isAnimating || openedBoxes.includes(prize.id)) return;
    
    setIsAnimating(true);
    setSelectedBox(prize.id);
    
    setTimeout(() => {
      setRevealedPrize(prize);
      setOpenedBoxes([...openedBoxes, prize.id]);
      setIsAnimating(false);
    }, 800);
  };

  const handleReset = () => {
    setOpenedBoxes([]);
    setRevealedPrize(null);
    setSelectedBox(null);
  };

  const handleClose = () => {
    setRevealedPrize(null);
    setSelectedBox(null);
  };

  if (!isLoggedIn) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center p-4 relative">
        <Star className="absolute top-20 left-10 text-yellow-300 opacity-20" size={40} />
        <Moon className="absolute top-40 right-20 text-purple-300 opacity-20" size={50} />
        <Zap className="absolute bottom-20 left-1/4 text-pink-300 opacity-20" size={35} />
        <Sparkles className="absolute bottom-40 right-1/3 text-blue-300 opacity-20" size={45} />

        <div className="max-w-6xl w-full text-center relative z-10">
          <h1 className="text-4xl md:text-6xl font-bold text-white mb-4">ğŸ Kotak Hadiah Misteri ğŸ</h1>
          <p className="text-purple-200 mb-8 text-lg">Masukkan User ID Anda untuk mulai bermain! âœ¨</p>
          
          <div className="max-w-md mx-auto bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl border-2 border-white/20">
            <label className="block text-white text-lg font-semibold mb-4 text-left">User ID:</label>
            <input 
              type="text" 
              value={userId}
              onChange={(e) => setUserId(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              placeholder="Masukkan User ID Anda" 
              className="w-full px-6 py-4 rounded-full text-center text-lg font-semibold bg-white text-purple-700 placeholder-purple-300 focus:outline-none focus:ring-4 focus:ring-yellow-300 transition-all"
              maxLength={50}
            />
            <button 
              onClick={handleLogin}
              className="w-full mt-6 inline-flex items-center justify-center gap-2 px-8 py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold rounded-full hover:from-yellow-500 hover:to-orange-600 transition-all duration-300 shadow-xl hover:scale-105 text-lg"
            >
              ğŸ® Mulai Bermain
            </button>
            <p className="text-white/60 text-sm mt-4">* User ID akan digunakan untuk identifikasi hadiah Anda</p>
          </div>
        </div>
      </div>
    );
  }

  if (showAllPrizes) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center p-4">
        <div className="max-w-6xl w-full">
          <h2 className="text-4xl md:text-5xl font-bold text-white mb-6 text-center">ğŸ Semua Hadiah Yang Tersedia ğŸ</h2>
          <p className="text-yellow-300 text-center mb-6 text-lg">Setiap kotak berisi hadiah yang berbeda!</p>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            {prizes.map((prize) => (
              <div key={prize.id} className={`bg-gradient-to-br ${prize.color} rounded-2xl p-6 shadow-xl border-4 border-yellow-300/50`}>
                <div className="flex items-center justify-between mb-4">
                  <span className="px-3 py-1 bg-white/30 text-white text-xs font-bold rounded-full">Hadiah Asli âœ“</span>
                  <span className="text-5xl">{prize.icon}</span>
                </div>
                <h3 className="text-2xl font-bold text-white mb-2">{prize.title}</h3>
                <p className="text-white/90 text-sm font-semibold">SCREENSHOT & KIRIM BUKTI KE LIVECHAT</p>
              </div>
            ))}
          </div>
          <div className="flex justify-center">
            <button 
              onClick={() => setShowAllPrizes(false)}
              className="inline-flex items-center gap-2 px-8 py-4 bg-white text-purple-700 font-bold rounded-full hover:bg-yellow-300 hover:text-purple-900 transition-all duration-300 shadow-xl hover:scale-105 text-lg"
            >
              â† Kembali
            </button>
          </div>
        </div>
      </div>
    );
  }

  if (revealedPrize) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center p-4">
        <div className="max-w-2xl w-full">
          <div className={`bg-gradient-to-br ${revealedPrize.color} rounded-3xl p-8 md:p-12 shadow-2xl border-4 border-yellow-300 relative`}>
            <div className="absolute top-0 left-1/4 text-yellow-300 text-4xl">ğŸ‰</div>
            <div className="absolute top-0 right-1/4 text-yellow-300 text-4xl">ğŸŠ</div>
            <div className="absolute bottom-1/4 left-1/3 text-white text-3xl">â­</div>
            <div className="absolute top-1/2 right-1/4 text-white text-3xl">âœ¨</div>

            <div className="mb-4 text-white/80 font-semibold">User ID: {userId}</div>
            <div className="flex items-center justify-between mb-6 relative z-10">
              <span className="px-4 py-2 bg-white/30 rounded-full text-white text-sm font-bold backdrop-blur-sm border-2 border-white/50 shadow-lg">
                {revealedPrize.category}
              </span>
              <span className="text-6xl md:text-7xl drop-shadow-lg">{revealedPrize.icon}</span>
            </div>

            <h2 className="text-3xl md:text-5xl font-black text-white mb-6 drop-shadow-lg text-center relative z-10">
              {revealedPrize.title}
            </h2>

            <div className="bg-white/20 rounded-2xl p-6 mb-8 backdrop-blur-sm border-2 border-white/30 shadow-xl relative z-10">
              <p className="text-white text-lg md:text-xl leading-relaxed font-semibold text-center">
                {revealedPrize.content}
              </p>
            </div>

            <div className="flex gap-4 justify-center relative z-10 flex-wrap">
              <a 
                href="https://wawasankini.com/" 
                target="_blank" 
                rel="noopener noreferrer"
                className="flex items-center gap-2 px-8 md:px-10 py-4 md:py-5 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-black rounded-full hover:from-green-600 hover:to-emerald-700 transition-all duration-300 shadow-2xl hover:scale-110 text-lg md:text-xl"
              >
                ğŸ Claim Hadiah Sekarang!
              </a>
            </div>
            <p className="text-white/80 text-sm mt-6 text-center relative z-10">* Klik tombol di atas untuk mengklaim hadiah Anda</p>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center p-4 relative">
      <Star className="absolute top-20 left-10 text-yellow-300 opacity-20" size={40} />
      <Moon className="absolute top-40 right-20 text-purple-300 opacity-20" size={50} />
      <Zap className="absolute bottom-20 left-1/4 text-pink-300 opacity-20" size={35} />
      <Sparkles className="absolute bottom-40 right-1/3 text-blue-300 opacity-20" size={45} />

      <div className="max-w-6xl w-full relative z-10">
        <div className="text-center">
          <h1 className="text-4xl md:text-6xl font-bold text-white mb-2">ğŸ Kotak Hadiah Misteri ğŸ</h1>
          <p className="text-yellow-300 mb-3 text-lg font-semibold">Selamat datang, <span className="text-white">{userId}</span>! ğŸ‘‹</p>
          <p className="text-purple-200 mb-8 text-lg">Pilih salah satu kotak dan menangkan hadiah menarik! âœ¨</p>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-6">
            {shuffledPrizes.map((prize) => {
              const isOpened = openedBoxes.includes(prize.id);
              const isSelected = selectedBox === prize.id && isAnimating;
              
              return (
                <div
                  key={prize.id}
                  onClick={() => handleBoxClick(prize)}
                  className={`relative transition-all duration-500 ${
                    isOpened ? 'opacity-30 scale-90' : 'cursor-pointer hover:scale-105 hover:-translate-y-2'
                  } ${isSelected ? 'scale-110 rotate-6' : ''}`}
                >
                  <div className="aspect-square bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl shadow-2xl flex flex-col items-center justify-center relative overflow-hidden border-4 border-yellow-300">
                    {isOpened ? (
                      <div className="relative text-center">
                        <div className="text-5xl md:text-6xl mb-2">{prize.icon}</div>
                        <div className="text-white font-bold text-xs md:text-sm px-2">{prize.title}</div>
                      </div>
                    ) : (
                      <div className="relative text-center">
                        <Gift size={50} className="text-white mb-2 mx-auto" />
                        <div className="text-white font-bold text-2xl">?</div>
                      </div>
                    )}

                    {!isOpened && (
                      <>
                        <Sparkles className="absolute top-2 right-2 text-yellow-200" size={20} />
                        <Sparkles className="absolute bottom-2 left-2 text-yellow-200" size={20} />
                      </>
                    )}
                  </div>
                </div>
              );
            })}
          </div>

          <div className="flex gap-4 justify-center flex-wrap">
            {openedBoxes.length > 0 && (
              <button
                onClick={handleReset}
                className="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold rounded-full hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-xl hover:scale-105"
              >
                <RefreshCw size={24} />
                Reset Semua Kotak
              </button>
            )}
            
            <button
              onClick={() => setShowAllPrizes(true)}
              className="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold rounded-full hover:from-yellow-500 hover:to-orange-600 transition-all duration-300 shadow-xl hover:scale-105"
            >
              <Gift size={24} />
              Tampilkan Semua Hadiah
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default MysteryBox;
